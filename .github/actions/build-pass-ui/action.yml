name: Build pass-ui project
description: |
  Builds the pass-ui project including creating a new :latest Docker image
  as well as a Docker image tagged with the current project version

inputs:
  env-file:
    description: 'URL location of .env file. Default is the .env file in "eclipse-pass/main"'
    default: 'https://raw.githubusercontent.com/eclipse-pass/pass-docker/main/.env'
  is-prod:
    description: Will this target production?
    required: false
    default: false

runs:
  using: composite
  steps:
    - name: Grab pass-docker's .env file and export to environment
      run: |
        wget ${{ inputs.env-file }}
        export $(grep -v '^[#|SIGNING]' .env | xargs -d '\n')
      shell: bash

    - run: yarn install --frozen-lockfile
      shell: bash

    - name: Production build
      run: yarn run build
      if: ${{ inputs.is-prod == true }}
      shell: bash

    - name: Dev build
      if: ${{ inputs.is-prod == false }}
      run: yarn run build:dev
      shell: bash

    - run: yarn run build:docker
      shell: bash

    - run: yarn run build:latest
      shell: bash

